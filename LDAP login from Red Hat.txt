
AD login from Red Hat (Domain name is: lab2016.local)
-------------------------------------------------------

* install required pkgs:  yum install samba-common adcli realmd oddjob-mkhomedir

* set hostname with the domain suffix: hostnamectl set-hostname centos8.lab2016.local

  !!!important!!! this step may OVERWRITE /etc/resolv.conf ! Backup it first!

* setup the domain's DNS settings in /etc/resolv.conf

  E.g.:
        
      [root@localhost yum.repos.d]# cat /etc/resolv.conf 
      ; generated by /usr/sbin/dhclient-script
      search lab2016.local
      nameserver 10.10.10.10

* test the connection to the domain on DNS level: realm discover -v lab2016.local

* join the domain: realm join -v --user admin lab2016.local


SOURCE
===========

https://www.youtube.com/watch?v=3TPgxpjgYsU


Output:
------------------------

[root@localhost yum.repos.d]# realm discover -v lab2016.local
 * Resolving: _ldap._tcp.lab2016.local
 * Performing LDAP DSE lookup on: 192.168.154.150
 * Successfully discovered: lab2016.local
lab2016.local
  type: kerberos
  realm-name: LAB2016.LOCAL
  domain-name: lab2016.local
  configured: no
  server-software: active-directory
  client-software: sssd
  required-package: oddjob
  required-package: oddjob-mkhomedir
  required-package: sssd
  required-package: adcli
  required-package: samba-common-tools


[root@localhost yum.repos.d]# realm join -v --user admin lab2016.local
 * Resolving: _ldap._tcp.lab2016.local
 * Performing LDAP DSE lookup on: 192.168.154.150
 * Successfully discovered: lab2016.local
Password for admin: 
 * Required files: /usr/sbin/oddjobd, /usr/libexec/oddjob/mkhomedir, /usr/sbin/sssd, /usr/sbin/adcli
 * LANG=C /usr/sbin/adcli join --verbose --domain lab2016.local --domain-realm LAB2016.LOCAL --domain-controller 192.168.154.150 --login-type user --login-user admin --stdin-password
 * Using domain name: lab2016.local
 * Calculated computer account name from fqdn: CENTOS8
 * Using domain realm: lab2016.local
 * Sending NetLogon ping to domain controller: 192.168.154.150
 * Received NetLogon info from: win2016-dc.lab2016.local
 * Wrote out krb5.conf snippet to /var/cache/realmd/adcli-krb5-K2tVqj/krb5.d/adcli-krb5-conf-zlDO6m
 * Authenticated as user: admin@LAB2016.LOCAL
 * Using GSS-SPNEGO for SASL bind
 * Looked up short domain name: LAB2016
 * Looked up domain SID: S-1-5-21-1991034343-979773886-2829617046
 * Using fully qualified name: centos8.lab2016.local
 * Using domain name: lab2016.local
 * Using computer account name: CENTOS8
 * Using domain realm: lab2016.local
 * Calculated computer account name from fqdn: CENTOS8
 * Generated 120 character computer password
 * Using keytab: FILE:/etc/krb5.keytab
 * A computer account for CENTOS8$ does not exist
 * Found well known computer container at: CN=Computers,DC=lab2016,DC=local
 * Calculated computer account: CN=CENTOS8,CN=Computers,DC=lab2016,DC=local
 * Encryption type [16] not permitted.
 * Encryption type [23] not permitted.
 * Encryption type [3] not permitted.
 * Encryption type [1] not permitted.
 * Created computer account: CN=CENTOS8,CN=Computers,DC=lab2016,DC=local
 * Sending NetLogon ping to domain controller: 192.168.154.150
 * Received NetLogon info from: win2016-dc.lab2016.local
 * Set computer password
 * Retrieved kvno '2' for computer account in directory: CN=CENTOS8,CN=Computers,DC=lab2016,DC=local
 * Checking RestrictedKrbHost/centos8.lab2016.local
 *    Added RestrictedKrbHost/centos8.lab2016.local
 * Checking RestrictedKrbHost/CENTOS8
 *    Added RestrictedKrbHost/CENTOS8
 * Checking host/centos8.lab2016.local
 *    Added host/centos8.lab2016.local
 * Checking host/CENTOS8
 *    Added host/CENTOS8
 * Discovered which keytab salt to use
 * Added the entries to the keytab: CENTOS8$@LAB2016.LOCAL: FILE:/etc/krb5.keytab
 * Added the entries to the keytab: host/CENTOS8@LAB2016.LOCAL: FILE:/etc/krb5.keytab
 * Added the entries to the keytab: host/centos8.lab2016.local@LAB2016.LOCAL: FILE:/etc/krb5.keytab
 * Added the entries to the keytab: RestrictedKrbHost/CENTOS8@LAB2016.LOCAL: FILE:/etc/krb5.keytab
 * Added the entries to the keytab: RestrictedKrbHost/centos8.lab2016.local@LAB2016.LOCAL: FILE:/etc/krb5.keytab
 ! Failed to update Kerberos configuration, not fatal, please check manually: Setting attribute standard::type not supported
 * /usr/bin/systemctl enable sssd.service
 * /usr/bin/systemctl restart sssd.service
 * /usr/bin/sh -c /usr/bin/authselect select sssd with-mkhomedir --force && /usr/bin/systemctl enable oddjobd.service && /usr/bin/systemctl start oddjobd.service
Backup stored at /var/lib/authselect/backups/2022-07-06-11-27-16.zXZNln
Profile "sssd" was selected.
The following nsswitch maps are overwritten by the profile:
- passwd
- group
- netgroup
- automount
- services

Make sure that SSSD service is configured and enabled. See SSSD documentation for more information.
 
- with-mkhomedir is selected, make sure pam_oddjob_mkhomedir module
  is present and oddjobd service is enabled
  - systemctl enable oddjobd.service
  - systemctl start oddjobd.service
Created symlink /etc/systemd/system/multi-user.target.wants/oddjobd.service â†’ /usr/lib/systemd/system/oddjobd.service.
 * Successfully enrolled machine in realm
